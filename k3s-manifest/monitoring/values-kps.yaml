# =========================
# kube-prometheus-stack
# =========================
fullnameOverride: kps

# BẬT node-exporter & kube-state-metrics (mặc định đã bật)
kube-state-metrics:
  enabled: true
prometheus-node-exporter:
  enabled: true

# -------------------------
# Grafana qua /grafana
# -------------------------
grafana:
  enabled: true
  adminUser: admin
  adminPassword: admin123  # đổi sau khi truy cập lần đầu
  service:
    type: ClusterIP
    port: 80
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "false"
    path: /grafana
    pathType: Prefix
    hosts:
      - 13.212.185.42.nip.io   # nếu không có domain, dùng nip.io để hợp lệ Host header
  grafana.ini:
    server:
      # BẮT BUỘC khi chạy dưới sub-path
      root_url: %(protocol)s://%(domain)s:%(http_port)s/grafana/
      serve_from_sub_path: true
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          url: http://kps-prometheus:9090
          access: proxy
          isDefault: true

# -------------------------
# Prometheus qua /prometheus
# -------------------------
prometheus:
  enabled: true
  service:
    type: ClusterIP
    port: 9090
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "false"
    paths:
      - /prometheus
    pathType: Prefix
    hosts:
      - 13.212.185.42.nip.io
  prometheusSpec:
    routePrefix: /prometheus
    externalUrl: http://13.212.185.42.nip.io/prometheus

# -------------------------
# Alertmanager qua /alertmanager
# -------------------------
alertmanager:
  enabled: true
  service:
    type: ClusterIP
    port: 9093
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "false"
    paths:
      - /alertmanager
    pathType: Prefix
    hosts:
      - 13.212.185.42.nip.io
  alertmanagerSpec:
    routePrefix: /alertmanager
    externalUrl: http://13.212.185.42.nip.io/alertmanager
